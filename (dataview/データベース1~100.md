---
aliases:
---
#database 

```dataviewjs
/***** 設定 *****/
const ZERO_PAD = 3;
const EXCLUDE_PATTERNS = [
  "/Templates/", "/template/", "/attachments/", "/_assets/",
  "/Daily/", "/Diary/", "/Journal/", "/_archive/"
];
const INCLUDE_TAGS = []; 
const START = 1;     // この索引の開始番号
const END   = 100;   // この索引の終了番号

/***** 収集 *****/
let pages = dv.pages()
  .where(p => p.file.ext === "md")
  .where(p => p.file.path !== dv.current().file.path)
  .where(p => {                       // 除外
    for (let x of EXCLUDE_PATTERNS) if (p.file.path.includes(x)) return false;
    return true;
  })
  .where(p => {                       // タグ制限
    if (INCLUDE_TAGS.length === 0) return true;
    return (p.file.tags ?? []).some(t => INCLUDE_TAGS.includes(t));
  })
  .sort(p => p.file.ctime, 'asc');

/***** 範囲でスライス *****/
let sliced = pages.slice(START - 1, END);

/***** DataArray → 配列化 *****/
let items = [];
for (let p of sliced) items.push(p);

/***** 行データ作成：本文を読み込んで文字数カウント *****/
let rowsData = [];
for (let i = 0; i < items.length; i++) {
  const p = items[i];
  const num = String(START + i).padStart(ZERO_PAD, "0");
  const c = p.file.ctime.toFormat("yyyy-MM-dd");
  const m = p.file.mtime.toFormat("yyyy-MM-dd");

  // ここがポイント：本文を読み込む（Top-level await OK）
  let text = "";
  try {
    text = await dv.io.load(p.file.path) ?? "";
  } catch (e) {
    // 読み込み失敗時は空文字のまま
  }
  const chars = text.length;

  rowsData.push({
    num,
    link: p.file.link,
    c, m,
    folder: p.file.folder,
    chars
  });
}

/***** 出力（テーブル） *****/
const header = ["#", "タイトル", "文字数", "作成日", "更新日", "パス"];
const rows = rowsData.map(r => [
  r.num,
  r.link,
  r.chars.toLocaleString(),
  r.c,
  r.m,
  r.folder
]);
dv.table(header, rows);

/***** まとめ（最大・平均・合計） *****/
if (rowsData.length) {
  let top = null;
  let sum = 0;
  for (let r of rowsData) {
    sum += r.chars;
    if (!top || r.chars > top.chars) top = r;
  }
  let avg = Math.round(sum / rowsData.length);
  dv.paragraph(`最大：**${top.link}**（${top.chars.toLocaleString()} 文字） / 平均：約${avg.toLocaleString()} 文字 / 合計：${sum.toLocaleString()} 文字`);
}

```
